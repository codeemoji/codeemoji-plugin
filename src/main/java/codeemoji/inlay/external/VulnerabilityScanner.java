package codeemoji.inlay.external;

import org.json.JSONArray;

import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.CompletableFuture;

public abstract class VulnerabilityScanner<T, U>{
    protected final String BASE_URL;
    protected final String API_KEY;

    protected Map<DependencyInfo, List<VulnerabilityInfo>> vulnerabilityMap = new HashMap<>();

    final HttpClient httpClient;

    public VulnerabilityScanner(String baseUrl, String apiKey) {
        this.BASE_URL = baseUrl;
        this.API_KEY = apiKey;
        this.httpClient = HttpClient.newHttpClient();
    }

    public abstract Map<DependencyInfo, List<VulnerabilityInfo>> scanVulnerability(DependencyInfo[] dependencies);

    protected abstract CompletableFuture<U> scanVulnerabilityAsync(T param);

    protected abstract void processResponse(U results, DependencyInfo[] dependencies);

    protected abstract Void handleError(Throwable throwable);

    protected abstract HttpRequest createRequest(T param);


    protected abstract List<VulnerabilityInfo> parseVulnerabilityInfo(JSONArray vulnerabilitiesArray);
}
