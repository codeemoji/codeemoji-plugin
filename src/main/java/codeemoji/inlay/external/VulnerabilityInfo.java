package codeemoji.inlay.external;

import codeemoji.inlay.vulnerabilities.Severity;
import lombok.Getter;

@Getter
public class VulnerabilityInfo {

    public enum ScannerType {
        OSS,
        NIST,
        OSV
    }

    private final ScannerType scanner;
    private final String cve;
    private final String description;
    private final Object severity;

    public VulnerabilityInfo(String cve, String description, Object severity, ScannerType scanner) {
        this.cve = cve;
        this.description = description;
        this.severity = severity;
        this.scanner = scanner;
    }

    public Severity getSeverity() {
        if (scanner == ScannerType.NIST) {
            return  Severity.parse((String) severity);
        }
        else if (scanner == ScannerType.OSS) {
            Float score = (Float) severity;
            if (score <= 5.5f) {
                return Severity.LOW;
            }
            else if (score <= 8.0f) {
                return Severity.MEDIUM;
            }
            else if (score < 10.0f) {
                return Severity.HIGH;
            }
            else if (score == 10.0f) {
                return Severity.CRITICAL;
            }
            else if (score > 10.0) {
                return Severity.UNKNOWN;
            }
        } else if (scanner == ScannerType.OSV) {
            String score = (String) severity;
            if (severity.equals("MODERATE")) {
                return Severity.MEDIUM;
            }
            return Severity.parse(score);
        }
        return Severity.UNKNOWN;
    }

}
